<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Reset Password | Helix Class Portal</title>
<script src="https://kit.fontawesome.com/a2d9a1b93b.js" crossorigin="anonymous"></script>

  <script src="https://www.gstatic.com/firebasejs/10.12.2/firebase-app.js"></script>
  <script src="https://www.gstatic.com/firebasejs/10.12.2/firebase-auth.js"></script>
  <script src="https://cdn.tailwindcss.com"></script>

  <script>
    // Firebase config (same as your index.html)
    const firebaseConfig = {
      apiKey: "AIzaSyB0--bDqGPckl7pENJLMN_95fDNAaXR4zs",
    authDomain: "helixfinale.firebaseapp.com",
    projectId: "helixfinale",
    storageBucket: "helixfinale.appspot.com",
    messagingSenderId: "556896526389",
    appId: "1:556896526389:web:0579fb75c4953f716cd17c",
    measurementId: "G-HB0DND8V2J"
    };
    firebase.initializeApp(firebaseConfig);

    // Parse reset link query
    const urlParams = new URLSearchParams(window.location.search);
    const oobCode = urlParams.get('oobCode');

    async function resetPassword(event) {
      event.preventDefault();
      const newPassword = document.getElementById('new-password').value;
      const confirmPassword = document.getElementById('confirm-password').value;

      if (newPassword !== confirmPassword) {
        alert('Passwords do not match!');
        return;
      }

      try {
        const auth = firebase.auth();
        await auth.confirmPasswordReset(oobCode, newPassword);
        alert('Password reset successful! Redirecting to login...');
        window.location.href = 'index.html';
      } catch (error) {
        alert('Error: ' + error.message);
      }
    }

    function togglePassword(id, iconId) {
      const input = document.getElementById(id);
      const icon = document.getElementById(iconId);
      if (input.type === "password") {
        input.type = "text";
        icon.classList.remove("fa-eye");
        icon.classList.add("fa-eye-slash");
      } else {
        input.type = "password";
        icon.classList.remove("fa-eye-slash");
        icon.classList.add("fa-eye");
      }
    }
  </script>

  <script src="https://kit.fontawesome.com/a2d9a1b93b.js" crossorigin="anonymous"></script>
</head>
<body class="min-h-screen bg-gradient-to-r from-blue-600 via-indigo-700 to-purple-700 flex items-center justify-center">
  <div class="bg-white shadow-lg rounded-xl p-8 w-full max-w-md text-center">
    <h1 class="text-2xl font-bold text-gray-800 mb-4">Reset Your Password</h1>
    <form id="reset-form" class="space-y-5">
  <div class="relative">
    <input id="new-password" type="password" placeholder="New Password"
           class="w-full border rounded px-3 py-2 pr-10" required>
    <i id="eye1" class="fa-solid fa-eye absolute right-3 top-3 text-gray-500 cursor-pointer"
       onclick="togglePassword('new-password','eye1')"></i>
  </div>
  <div class="relative">
    <input id="confirm-password" type="password" placeholder="Confirm Password"
           class="w-full border rounded px-3 py-2 pr-10" required>
    <i id="eye2" class="fa-solid fa-eye absolute right-3 top-3 text-gray-500 cursor-pointer"
       onclick="togglePassword('confirm-password','eye2')"></i>
  </div>
  <button type="submit" class="w-full bg-purple-700 text-white py-2 rounded">
    Reset Password
  </button>
  <div id="reset-message" class="text-sm mt-2"></div>
</form>

  </div>

  <script type="module">
  import { initializeApp } from "https://www.gstatic.com/firebasejs/10.12.2/firebase-app.js";
  import { getAuth, confirmPasswordReset } from "https://www.gstatic.com/firebasejs/10.12.2/firebase-auth.js";

  // --- your actual Firebase config ---
  const firebaseConfig = {
    apiKey: "AIzaSyB0--bDqGPckl7pENJLMN_95fDNAaXR4zs",
    authDomain: "helixfinale.firebaseapp.com",
    projectId: "helixfinale",
    storageBucket: "helixfinale.appspot.com",
    messagingSenderId: "556896526389",
    appId: "1:556896526389:web:0579fb75c4953f716cd17c",
    measurementId: "G-HB0DND8V2J"
  };

  // initialize Firebase (module style)
  const app = initializeApp(firebaseConfig);
  const auth = getAuth(app);

  // read query params from Firebase reset link
  const params = new URLSearchParams(window.location.search);
  const mode = params.get('mode');
  const oobCode = params.get('oobCode');

  // expose eye toggle globally
  window.togglePassword = function (inputId, iconId) {
    const input = document.getElementById(inputId);
    const icon = document.getElementById(iconId);
    if (input.type === 'password') {
      input.type = 'text';
      icon.classList.replace('fa-eye', 'fa-eye-slash');
    } else {
      input.type = 'password';
      icon.classList.replace('fa-eye-slash', 'fa-eye');
    }
  };

  // wait for DOM, attach submit handler
  document.addEventListener('DOMContentLoaded', () => {
    const form = document.getElementById('reset-form');
    const newPw = document.getElementById('new-password');
    const confirmPw = document.getElementById('confirm-password');
    const msg = document.getElementById('reset-message');

    if (!form) return;

    form.addEventListener('submit', async (e) => {
      e.preventDefault();
      msg.textContent = '';

      if (!oobCode || mode !== 'resetPassword') {
        msg.textContent = 'Invalid or expired reset link.';
        return;
      }
      if (newPw.value !== confirmPw.value) {
        msg.textContent = 'Passwords do not match.';
        return;
      }

      try {
        await confirmPasswordReset(auth, oobCode, newPw.value);
        msg.style.color = 'green';
        msg.textContent = 'Password reset successful. Redirecting...';
        setTimeout(() => (window.location.href = '/index.html'), 1500);
      } catch (err) {
        msg.style.color = 'red';
        msg.textContent = 'Error: ' + err.message;
      }
    });
  });
</script>

</body>
</html>
